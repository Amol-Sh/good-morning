<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smart Greeting</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #ffe082, #ffab91);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .card {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 24px;
      padding: 24px 28px;
      max-width: 420px;
      width: 90%;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      text-align: center;
    }
    h1 {
      margin: 0 0 8px;
      font-size: 2rem;
      color: #4e342e;
    }
    p {
      margin: 4px 0;
      color: #5d4037;
      font-size: 0.95rem;
      word-break: break-word;
    }
    .label {
      font-weight: 600;
    }
    .small {
      font-size: 0.8rem;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1 id="greeting">Loading greeting…</h1>

    <p id="location-text"><span class="label">Location:</span> Detecting…</p>
    <p id="coords-text" class="small"></p>
    <p class="small" id="status-text"></p>
  </div>

  <script>
    // ---------- Time-based greeting ----------
    function getGreetingByTime(date = new Date()) {
      const hour = date.getHours(); // local time of the user
      if (hour < 12) return "Good Morning";
      if (hour < 17) return "Good Afternoon";
      if (hour < 21) return "Good Evening";
      return "Good Night";
    }

    document.getElementById("greeting").textContent = getGreetingByTime();

    // ---------- Geolocation + reverse geocoding ----------
    const locationEl = document.getElementById("location-text");
    const coordsEl = document.getElementById("coords-text");
    const statusEl = document.getElementById("status-text");

    function setStatus(msg) {
      statusEl.textContent = msg || "";
    }

    if (!("geolocation" in navigator)) {
      locationEl.innerHTML = '<span class="label">Location:</span> Not supported on this device.';
    } else {
      setStatus("Requesting precise location…");

      navigator.geolocation.getCurrentPosition(
        async (pos) => {
          const { latitude, longitude, accuracy } = pos.coords;

          // Show raw coordinates (high precision)
          coordsEl.textContent =
            `Lat: ${latitude.toFixed(6)}, Lon: ${longitude.toFixed(6)} ` +
            `(Accuracy: ±${Math.round(accuracy)} m)`;

          // Reverse geocode using OpenStreetMap Nominatim
          try {
            // NOTE: For heavy/production use, use your own geocoding service or key.
            const url =
              `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}&zoom=18&addressdetails=1`;

            const res = await fetch(url, {
              headers: {
                // Helps identify your app to the service
                "Accept": "application/json"
              }
            });

            if (!res.ok) throw new Error("Reverse geocoding failed");

            const data = await res.json();
            const address = data.address || {};

            // Build a very "nearby" style name: road + neighbourhood + suburb/town
            const parts = [
              address.house_number && address.road
                ? `${address.house_number} ${address.road}`
                : address.road,
              address.neighbourhood || address.residential || address.suburb || address.village,
              address.city || address.town || address.county,
              address.state,
              address.postcode
            ].filter(Boolean);

            const niceName = parts.join(", ");

            locationEl.innerHTML =
              '<span class="label">Location:</span> ' +
              (niceName || data.display_name || "Exact address not available");

            setStatus("");
          } catch (err) {
            console.error(err);
            locationEl.innerHTML =
              '<span class="label">Location:</span> Detected, but name lookup failed.';
            setStatus("Could not fetch nearby place name.");
          }
        },
        (err) => {
          console.error(err);
          locationEl.innerHTML =
            '<span class="label">Location:</span> Permission denied or unavailable.';
          setStatus(err.message || "Unable to get your location.");
        },
        {
          enableHighAccuracy: true, // ask for GPS-level accuracy
          timeout: 15000,
          maximumAge: 0
        }
      );
    }
  </script>
</body>
  </html>
